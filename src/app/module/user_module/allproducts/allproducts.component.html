<button class="ml-2 btn btn-outline-secondary px-4 rounded-pill shadow-sm hover-scale back-btn" (click)="goBack()"><i
        class="bi bi-arrow-left me-2"></i>Back to Home</button>

<section class="product-section">
    <div class="w-layout-blockcontainer container-fluid w-container">
        <div class="product-section-wrapper">
            <div class="product-heading-wrapper">
                <!-- Product Heading -->
                <div class="text-center mb-5">
                    <div class="section-title">
                        <h2 class="section-heading text-center">
                            <span *ngIf="searchQuery">Search Results for "{{ searchQuery }}"</span>
                            <span *ngIf="!searchQuery">Our Products</span>
                        </h2>
                        <p *ngIf="searchQuery" class="text-muted mt-2">
                            Found {{ filteredProducts.length }} product(s)
                        </p>
                    </div>
                </div>

                <!-- Filter Toggle Button (Mobile) -->
                <div class="filter-toggle-mobile mb-3">
                    <button class="btn btn-filter-toggle" (click)="toggleFilter()">
                        <i class="bi bi-funnel me-2"></i>
                        {{ isFilterOpen ? 'Hide Filters' : 'Show Filters' }}
                        <span *ngIf="selectedCategories.length > 0 || selectedGenders.length > 0 || selectedSizes.length > 0" 
                              class="filter-count">{{ selectedCategories.length + selectedGenders.length + selectedSizes.length }}</span>
                    </button>
                </div>

                <!-- Main Content with Filters -->
                <div class="products-layout">
                    <!-- Filter Sidebar -->
                    <aside class="filter-sidebar" [class.open]="isFilterOpen">
                        <div class="filter-header">
                            <h3 class="filter-title">
                                <i class="bi bi-funnel-fill me-2"></i>Filters
                            </h3>
                            <button class="btn-clear-all" (click)="clearAllFilters()" *ngIf="selectedCategories.length > 0 || selectedGenders.length > 0 || selectedSizes.length > 0">
                                <i class="bi bi-x-circle me-1"></i>Clear All
                            </button>
                        </div>

                        <div class="filter-content">
                            <!-- Category Filter -->
                            <div class="filter-group">
                                <h4 class="filter-group-title">
                                    <i class="bi bi-tag-fill me-2"></i>Category
                                </h4>
                                <div class="filter-options">
                                    <label *ngFor="let category of categoryList" class="filter-checkbox">
                                        <input type="checkbox" 
                                               [value]="category.categoryName"
                                               [checked]="selectedCategories.includes(category.categoryName)"
                                               (change)="onCategoryChange(category.categoryName, $event)">
                                        <span class="checkmark"></span>
                                        <span class="filter-label">{{ category.categoryName }}</span>
                                        <span class="filter-count-badge">{{ getCategoryCount(category.categoryName) }}</span>
                                    </label>
                                </div>
                            </div>

                            <!-- Gender Filter -->
                            <div class="filter-group">
                                <h4 class="filter-group-title">
                                    <i class="bi bi-person-fill me-2"></i>Gender
                                </h4>
                                <div class="filter-options">
                                    <label *ngFor="let gender of genderList" class="filter-checkbox">
                                        <input type="checkbox" 
                                               [value]="gender.genderName"
                                               [checked]="selectedGenders.includes(gender.genderName)"
                                               (change)="onGenderChange(gender.genderName, $event)">
                                        <span class="checkmark"></span>
                                        <span class="filter-label">{{ gender.genderName }}</span>
                                        <span class="filter-count-badge">{{ getGenderCount(gender.genderName) }}</span>
                                    </label>
                                </div>
                            </div>

                            <!-- Size Filter -->
                            <div class="filter-group">
                                <h4 class="filter-group-title">
                                    <i class="bi bi-rulers me-2"></i>Size
                                </h4>
                                <div class="filter-options size-options">
                                    <label *ngFor="let size of availableSizes" class="filter-checkbox size-checkbox">
                                        <input type="checkbox" 
                                               [value]="size"
                                               [checked]="selectedSizes.includes(size)"
                                               (change)="onSizeChange(size, $event)">
                                        <span class="checkmark"></span>
                                        <span class="filter-label size-label">{{ size }}</span>
                                    </label>
                                </div>
                            </div>

                            <!-- Price Filter -->
                            <div class="filter-group">
                                <h4 class="filter-group-title">
                                    <i class="bi bi-currency-rupee me-2"></i>Price Range
                                </h4>
                                <div class="price-filter">
                                    <div class="price-inputs">
                                        <div class="price-input-group">
                                            <label>Min</label>
                                            <input type="number" 
                                                   [(ngModel)]="priceRange[0]" 
                                                   [min]="minPrice" 
                                                   [max]="maxPrice"
                                                   (ngModelChange)="onPriceChange()"
                                                   class="price-input">
                                        </div>
                                        <div class="price-input-group">
                                            <label>Max</label>
                                            <input type="number" 
                                                   [(ngModel)]="priceRange[1]" 
                                                   [min]="minPrice" 
                                                   [max]="maxPrice"
                                                   (ngModelChange)="onPriceChange()"
                                                   class="price-input">
                                        </div>
                                    </div>
                                    <p class="price-range-display">
                                        â‚¹{{ priceRange[0] | number:'1.0-0' }} - â‚¹{{ priceRange[1] | number:'1.0-0' }}
                                    </p>
                                </div>
                            </div>

                            <!-- Results Count -->
                            <div class="filter-results">
                                <p class="results-count">
                                    <strong>{{ filteredProducts.length }}</strong> product(s) found
                                </p>
                            </div>
                        </div>
                    </aside>

                    <!-- Product Body -->
                    <div class="product-section-inner-1">
                    <div class="products-tab w-tabs">
                        <div class="products-tab-menu w-tab-menu" role="tablist">
                            <!-- <a *ngFor="let category of categoryList; let i = index" [attr.data-w-tab]="category._id"
                                class="products-tab-link w-inline-block w-tab-link"
                                [ngClass]="{ 'w--current': selectedCategory === category.categoryName }"
                                [id]="'w-tabs-0-data-w-tab-' + i" href="javascript:void(0)" role="tab"
                                (click)="selectCategory(category.categoryName)"
                                [attr.aria-controls]="'w-tabs-0-data-w-pane-' + i"
                                [attr.aria-selected]="selectedCategory === category.categoryName ? 'true' : 'false'"
                                [attr.tabindex]="selectedCategory === category.categoryName ? null : '-1'">
                                <div class="products-tab-nav">{{ category.categoryName }}</div>
                            </a> -->
                        </div>

                        <!-- No Products Message -->
                            <div *ngIf="filteredProducts.length === 0"
                                class="w-full flex items-center justify-center py-16 px-4">

                                <div
                                    class="max-w-md w-full bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg p-8 text-center border border-gray-200">

                                    <!-- Icon -->
                                    <div
                                        class="mx-auto mb-5 flex h-20 w-20 items-center justify-center rounded-full bg-yellow-100">
                                        <i class="bi bi-box-seam text-4xl text-yellow-600"></i>
                                    </div>

                                    <!-- Title -->
                                    <h3 class="text-2xl font-semibold text-gray-800 mb-2">
                                        No Products Available
                                    </h3>

                                    <!-- Description -->
                                    <p class="text-gray-600 text-sm sm:text-base mb-6">
                                        We couldnâ€™t find any products in this category right now.
                                        Please check back later or explore other categories.
                                    </p>

                                    <!-- Action -->
                                    <button (click)="goBacktoProducts()"
                                        class="inline-flex items-center justify-center rounded-full bg-black text-white px-6 py-3 text-sm font-medium hover:bg-gray-800 transition-all">
                                        View All Products
                                    </button>
                                </div>
                            </div>

                        <div *ngIf="filteredProducts.length > 0" class="row g-4">
                            <!-- Loop through products -->
                            <div class="col-lg-3 col-md-4 col-sm-6" *ngFor="let product of filteredProducts">
                                <div class="product-card">

                                    <div class="product-img cursor-pointer" (click)="viewDetails(product)">
                                        <!-- Sale / New Badge -->
                                        <span *ngIf="product.discountPrice" class="badge sale-badge">Sale</span>
                                        <span *ngIf="!product.discountPrice" class="badge new-badge">New</span>

                                        <!-- ðŸ· Stock Badge -->
                                        <span *ngIf="!product.inStock" class="badge stock-badge out-stock">Out of
                                            Stock</span>
                                        <span *ngIf="product.inStock && product.totalStock <= 5"
                                            class="badge stock-badge low-stock">Low Stock</span>

                                        <!-- Front Image -->
                                        <img [src]="product.images" [alt]="product.productName"
                                            class="img-fluid front-img">

                                        <!-- Hover Image -->
                                        <img *ngIf="product.gallery && product.gallery.length > 0"
                                            [src]="product.gallery[0]" [alt]="product.productName"
                                            class="img-fluid back-img">

                                        <!-- Wishlist & Cart Icons -->
                                        <div class="product-icons">
                                            <button class="icon-btn" (click)="toggleWishlist(product, $event)">
                                                <i [ngClass]="{
                  'bi bi-heart': !product.isWishlisted,
                  'bi bi-heart-fill text-danger animate-bounce': product.isWishlisted
                }"></i>
                                            </button>
                                            <button class="icon-btn" (click)="addToCart(product)">
                                                <i class="bi bi-cart"></i>
                                            </button>
                                        </div>

                                        <!-- ðŸ‘ Quick View Button -->
                                        <button class="quick-view-btn" (click)="openQuickView(product,$event)"><i
                                                class="bi bi-eye me-1"></i> Quick View</button>
                                    </div>

                                    <!-- Product Content -->
                                    <div class="product-content text-center p-3">
                                        <h5 class="product-title">{{ product.productName }}</h5>

                                        <!-- Price with discount -->
                                        <p class="product-price">
                                            <span *ngIf="product.discountPrice" class="discount">
                                                â‚¹{{ product.discountPrice }}
                                            </span>
                                            <span [class.old-price]="product.discountPrice">
                                                â‚¹{{ product.price }}
                                            </span>
                                        </p>

                                        <!-- â­ Ratings -->
                                        <div class="rating" *ngIf="product.rating">
                                            <ng-container *ngFor="let star of [1,2,3,4,5]; let i = index">
                                                <i class="bi" [ngClass]="{
                  'bi-star-fill': star <= product.rating.average,
                  'bi-star-half': star - 0.5 === product.rating.average,
                  'bi-star': star > product.rating.average
                }"></i>
                                            </ng-container>
                                            <span>({{ product.rating.count }})</span>
                                        </div>

                                        <button class="btn btn-dark buy-btn" (click)="buyNow(product)">
                                            Buy Now <i class="bi bi-bag ml-2"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Quick View Modal -->
                        <div class="modal-backdrop" *ngIf="selectedProduct">
                            <app-quick-view [selectedProducts]="selectedProduct"
                                (closeEmitter)="closeQuickView()"></app-quick-view>
                        </div>
                    </div>
                </div>
                </div>
            </div>
        </div>
    </div>
</section>