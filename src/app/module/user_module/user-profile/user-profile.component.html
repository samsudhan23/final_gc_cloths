<div>
    <div *ngIf="isLoggedIn">
        <app-sign-in></app-sign-in>
    </div>

    <div *ngIf="!isLoggedIn">
        <div class="profile-shell">
            <div class="account-page">
                <aside class="sidebar" aria-label="Account navigation">
                    <div class="welcome">
                        <button class="avatar editable" type="button" (click)="openProfileEditor()"
                            title="Edit profile">
                            <img *ngIf="user.avatarUrl; else initialsTmpl" [src]="user.avatarUrl"
                                (error)="onAvatarError()" [alt]="user.name" />
                            <ng-template #initialsTmpl>
                                {{ user.initials }}
                            </ng-template>
                            <span class="avatar-edit-indicator">âœŽ</span>
                        </button>
                        <div class="greetings">
                            <p class="hello">Welcome,</p>
                            <h2 class="name">{{ user.name }}</h2>
                            <p class="email">{{ user.email }}</p>
                        </div>
                    </div>

                    <nav class="menu">
                        <button *ngFor="let item of menuItems" class="menu-item"
                            [class.active]="activeMenu === item.key" (click)="setActiveMenu(item.key)"
                            [attr.aria-current]="activeMenu === item.key ? 'page' : null" type="button">
                            <span class="label">{{ item.label }}</span>
                        </button>
                    </nav>
                </aside>

                <main class="content">
                    <section *ngIf="activeMenu === 'orders'" class="orders-section">
                        <header class="section-header">
                            <h3>Orders</h3>
                            <input class="search" type="search" placeholder="Search order # or product" />
                        </header>

                        <div class="orders-list">
                            <article class="order-card" *ngFor="let order of orders">
                                <div class="order-meta">
                                    <div class="row">
                                        <span class="meta-label">Order number</span>
                                        <span class="meta-value">#{{ order.orderNumber }}</span>
                                    </div>
                                    <div class="row">
                                        <span class="meta-label">Shipped date</span>
                                        <span class="meta-value">{{ order.shippedDate | date: 'mediumDate' }}</span>
                                    </div>
                                    <div class="row">
                                        <span class="meta-label">Total</span>
                                        <span class="meta-value">{{ order.total | currency: 'USD' }}</span>
                                    </div>
                                    <div class="row">
                                        <span class="meta-label">Status</span>
                                        <span class="status" [class]="'status ' + getStatusClass(order.status)">
                                            {{ order.status }}
                                        </span>
                                    </div>
                                </div>

                                <div class="order-actions">
                                    <button class="btn outline" *ngIf="order.status === 'Delivered'" type="button"
                                        (click)="viewOrder(order.orderNumber)">
                                        View order
                                    </button>
                                    <button class="btn primary" *ngIf="order.status === 'Out for delivery'"
                                        type="button" (click)="viewOrder(order.orderNumber)">
                                        Track order
                                    </button>
                                    <button class="btn outline" *ngIf="order.status === 'Processing'" type="button"
                                        (click)="viewOrder(order.orderNumber)">
                                        View order
                                    </button>
                                    <button class="btn danger ghost" *ngIf="order.cancellable" type="button">
                                        Cancel order
                                    </button>
                                </div>
                            </article>
                        </div>
                    </section>

                    <section *ngIf="activeMenu === 'personal'">
                        <app-user-personal-info [user]="user" 
                            (profileSaved)="onPersonalProfileSaved($event)"
                            (profileImageChanged)="onProfileImageChanged($event)">
                        </app-user-personal-info>
                    </section>

                    <section *ngIf="activeMenu === 'addresses'">
                        <app-deliveryaddress></app-deliveryaddress>
                    </section>

                    <section *ngIf="activeMenu === 'signout'" class="signout-section">
                        <div class="modal-backdrop" aria-hidden="true"></div>
                        <div class="modal" role="dialog" aria-modal="true" aria-label="Logout confirmation">
                            <div class="signout-card square">
                                <h3>Logout confirmation</h3>
                                <p>Are you sure you want to log out?</p>
                                <div class="form-actions centered">
                                    <button class="btn outline" type="button"
                                        (click)="setActiveMenu('orders')">Cancel</button>
                                    <button class="btn danger" type="button" (click)="logOut()">Confirm</button>
                                </div>
                            </div>
                        </div>
                    </section>

                    <section *ngIf="activeMenu !== 'orders' && activeMenu !== 'signout'" class="placeholder">
                        <!-- <h3>{{ getActiveMenuLabel() }}</h3> -->
                    </section>
                </main>
            </div>
        </div>
        <div class="toast" *ngIf="toastVisible">{{ toastMessage }}</div>
    </div>
</div>