<button class="ml-2 btn btn-outline-secondary px-4 rounded-pill shadow-sm hover-scale back-btn mobile-back-btn" (click)="goBack()"><i
        class="bi bi-arrow-left me-2"></i>Back
    to Products</button>
<div class="container py-5 product-details-container" *ngIf="filteredProducts">
    <div class="grid grid-cols-4 gap-4 product-grid">
        <!-- Gallery -->
        <div class="col-span-2 image-column">
            <span>
                  <button class="nav prev" (click)="moveSlide('prev')">&#10094;</button>
            </span>
            <div #sliderContainer class="slider-wrapper cursor-pointer">
                <div class="slider" *ngIf="filteredProducts">
                    <div class="slide" *ngIf="filteredProducts.images">
                        <img [src]="filteredProducts.images" [alt]="filteredProducts.productName" />
                    </div>
                    <div class="slide" *ngFor="let img of filteredProducts.gallery; let i = index">
                        <img [src]="img" [alt]="filteredProducts.productName + ' - Image ' + (i + 1)" />
                    </div>
                </div>
            </div>
             <span>
            <button class="nav next" (click)="moveSlide('next')">&#10095;</button>
             </span>
        </div>

        <!-- Product Info - Redesigned with Animations -->
        <div class="col-span-2 product-info-container">
            <!-- Product Name with Fade-in Animation -->
            <div class="product-header">
                <h2 class="product-title animate-fade-in">{{ filteredProducts.productName }}</h2>
                <p class="product-description animate-slide-up">{{ filteredProducts.productDescription }}</p>
            </div>

            <!-- Price Section with Discount Badge Animation -->
            <div class="price-section animate-scale-in">
                <div class="price-container">
                    <div class="current-price">
                        <span *ngIf="filteredProducts.discountPrice" class="discount-price">
                            ₹{{ filteredProducts.discountPrice }}
                        </span>
                        <span *ngIf="!filteredProducts.discountPrice" class="regular-price">
                            ₹{{ filteredProducts.price }}
                        </span>
                    </div>
                    <span *ngIf="filteredProducts.discountPrice" class="original-price">
                        ₹{{ filteredProducts.price }}
                    </span>
                    <span *ngIf="filteredProducts.discountPrice" class="discount-badge">
                        {{ ((filteredProducts.price - filteredProducts.discountPrice) / filteredProducts.price * 100).toFixed(0) }}% OFF
                    </span>
                </div>
            </div>

            <!-- Category & Gender with Icons -->
            <div class="product-meta animate-slide-up-delay">
                <div class="meta-item">
                    <i class="bi bi-tag-fill meta-icon"></i>
                    <div class="meta-content">
                        <span class="meta-label">Category</span>
                        <span class="meta-value">{{ filteredProducts.category.categoryName }}</span>
                    </div>
                </div>
                <div class="meta-item">
                    <i class="bi bi-person-fill meta-icon"></i>
                    <div class="meta-content">
                        <span class="meta-label">Gender</span>
                        <span class="meta-value">{{ filteredProducts.gender.genderName }}</span>
                    </div>
                </div>
            </div>

            <!-- Stock Badge with Pulse Animation -->
            <div class="stock-badge-container animate-fade-in-delay">
                <span *ngIf="!filteredProducts.inStock" class="stock-badge stock-out pulse-animation">
                    <i class="bi bi-x-circle me-1"></i>Out of Stock
                </span>
                <span *ngIf="filteredProducts.inStock && filteredProducts.totalStock <= 5" 
                      class="stock-badge stock-low pulse-animation">
                    <i class="bi bi-exclamation-triangle me-1"></i>Low Stock
                </span>
                <span *ngIf="filteredProducts.inStock && filteredProducts.totalStock > 5" 
                      class="stock-badge stock-in pulse-animation">
                    <i class="bi bi-check-circle me-1"></i>In Stock
                </span>
            </div>

            <!-- Sizes with Enhanced Animation -->
            <div class="sizes-section animate-slide-up-delay-2">
                <div class="section-header">
                    <i class="bi bi-rulers section-icon"></i>
                    <strong class="section-title">Available Sizes</strong>
                </div>
                <div class="sizes-grid">
                    <span *ngFor="let size of filteredProducts.sizeStock; let i = index" 
                          (click)="selectSize(size)" 
                          class="size-chip-modern" 
                          [ngClass]="{
                            'selected': selectedSize === size.size,
                            'disabled': size.stock === 0
                          }"
                          [style.animation-delay]="(i * 0.1) + 's'">
                        <span class="size-label">{{ size.size }}</span>
                        <span class="size-stock">({{ size.stock }})</span>
                    </span>
                </div>
            </div>

            <!-- Quantity Selector with Modern Design -->
            <div class="quantity-section animate-slide-up-delay-3">
                <div class="section-header">
                    <i class="bi bi-123 section-icon"></i>
                    <strong class="section-title">Quantity</strong>
                </div>
                <div class="quantity-controls">
                    <button (click)="quantityAdding('minus')"
                            class="quantity-btn quantity-minus"
                            [disabled]="quantityValue == 1"
                            [class.disabled]="quantityValue == 1">
                        <i class="pi pi-minus"></i>
                    </button>
                    <div class="quantity-display">
                        <span class="quantity-value">{{ quantityValue }}</span>
                    </div>
                    <button (click)="quantityAdding('add')"
                            class="quantity-btn quantity-plus"
                            [disabled]="quantityValue == this.stock"
                            [class.disabled]="quantityValue == this.stock">
                        <i class="pi pi-plus"></i>
                    </button>
                </div>
            </div>

            <!-- Action Buttons with Enhanced Animations -->
            <div class="action-buttons grid md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-4 animate-fade-in-delay-2">
                <!-- <button class="action-btn btn-buy-now" (click)="buyNow(filteredProducts)">
                    <i class="bi bi-bag-check-fill"></i>
                    <span>Buy Now</span>
                    <div class="btn-ripple"></div>
                </button> -->
                
                @if(!isGotoCart){
                <button class="action-btn btn-add-cart" (click)="addToCart(filteredProducts)">
                    <i class="bi bi-cart-plus"></i>
                    <span>Add to Cart</span>
                    <div class="btn-ripple"></div>
                </button>
                }
                
                @if(isGotoCart){
                <button class="action-btn btn-go-cart" (click)="goToCart()">
                    <i class="bi bi-cart-check"></i>
                    <span>Go to Cart</span>
                    <div class="btn-ripple"></div>
                </button>
                }
                
                <button class="action-btn btn-wishlist" 
                        (click)="toggleWishlist(filteredProducts,$event)"
                        [class.active]="filteredProducts.isWishlisted">
                    <i [ngClass]="filteredProducts.isWishlisted ? 'bi bi-heart-fill' : 'bi bi-heart'"></i>
                    <span>Wishlist</span>
                    <div class="btn-ripple"></div>
                </button>
            </div>

            <!-- Share Section with Animated Icons -->
            <div class="share-section animate-slide-up-delay-4">
                <div class="section-header">
                    <i class="bi bi-share-fill section-icon"></i>
                    <span class="section-title">Share</span>
                </div>
                <div class="share-icons">
                    <a [href]="'https://wa.me/?text=Check this out: ' + currentUrl" 
                       target="_blank"
                       class="share-icon share-whatsapp"
                       title="Share on WhatsApp">
                        <i class="bi bi-whatsapp"></i>
                    </a>
                    <a [href]="'https://www.facebook.com/sharer/sharer.php?u=' + currentUrl" 
                       target="_blank"
                       class="share-icon share-facebook"
                       title="Share on Facebook">
                        <i class="bi bi-facebook"></i>
                    </a>
                    <a [href]="'https://twitter.com/intent/tweet?url=' + currentUrl" 
                       target="_blank"
                       class="share-icon share-twitter"
                       title="Share on Twitter">
                        <i class="bi bi-twitter-x"></i>
                    </a>
                    <a href="https://www.instagram.com/" 
                       target="_blank"
                       class="share-icon share-instagram"
                       title="Share on Instagram">
                        <i class="bi bi-instagram"></i>
                    </a>
                    <button (click)="copyLink()" 
                            class="share-icon share-link"
                            title="Copy link">
                        <i class="bi bi-link-45deg"></i>
                        <span *ngIf="linkCopied" class="copy-tooltip">Copied!</span>
                    </button>
                </div>
            </div>

            <!-- Delivery Details with Enhanced Animation -->
            <div class="delivery-section animate-slide-up-delay-5">
                <div class="section-header">
                    <i class="bi bi-truck section-icon"></i>
                    <h3 class="section-title">Delivery Details</h3>
                </div>
                
                <div class="pincode-input-group">
                    <div class="input-wrapper">
                        <i class="bi bi-geo-alt input-icon"></i>
                        <input type="text" 
                               [(ngModel)]="pincode" 
                               maxlength="6" 
                               placeholder="Enter Pincode"
                               class="pincode-input"
                               [class.checked]="pincodeChecked" />
                    </div>
                    <button (click)="checkPincode()" 
                            class="pincode-check-btn"
                            [class.checked]="pincodeChecked">
                        <span *ngIf="!pincodeChecked">Check</span>
                        <span *ngIf="pincodeChecked">Change</span>
                    </button>
                </div>

                <!-- Animated delivery info -->
                <div [@slideToggle]="pincodeChecked ? 'open' : 'closed'"
                     class="delivery-info">
                    <div class="delivery-item">
                        <div class="delivery-icon-wrapper">
                            <i class="bi bi-cash-coin delivery-icon"></i>
                        </div>
                        <p class="delivery-text">Cash on delivery is available</p>
                    </div>

                    <div class="delivery-item">
                        <div class="delivery-icon-wrapper">
                            <i class="bi bi-truck delivery-icon"></i>
                        </div>
                        <p class="delivery-text">
                            Estimated Delivery by <strong class="delivery-date">{{ estimatedDelivery }}</strong>
                        </p>
                    </div>

                    <div class="delivery-item delivery-return">
                        <div class="delivery-icon-wrapper">
                            <i class="bi bi-arrow-repeat delivery-icon"></i>
                        </div>
                        <p class="delivery-text">
                            This product is eligible for return or exchange under our 07-days return or exchange policy.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="mt-10 space-y-4">
        <div *ngFor="let section of productSections" class="border rounded-lg shadow-sm overflow-hidden bg-white">
            <button (click)="toggleSection(section)"
                class="w-full flex justify-between items-center px-5 py-3 bg-[#f4fae7] hover:bg-gray-100 transition-all duration-300">
                <span class="font-semibold text-gray-800 text-lg">
                    {{ section.title }}
                </span>
                <i class="bi bi-chevron-down text-gray-600" [@rotateChevron]="section.open ? 'up' : 'down'"></i>
            </button>

            <div [@expandCollapse]="section.open ? 'open' : 'closed'" class="text-gray-700 text-sm leading-relaxed">
                <div class="px-5 py-4">
                    <p [innerHTML]="section.content"></p>
                </div>
            </div>
        </div>
    </div>




    <!-- Related Products -->
    <div class="related-products mt-5" *ngIf="relatedProducts.length > 0">
        <h3 class="fw-bold mb-4">Related Products</h3>
        <div class="row g-4">
            <div class="col-lg-3 col-md-4 col-sm-6" *ngFor="let rp of relatedProducts">
                <div class="filteredProducts-card" (click)="goToDetails(rp)">
                    <div class="filteredProducts-img">
                        <img [src]="rp.images" [alt]="rp.productName" class="img-fluid front-img">
                    </div>
                    <div class="filteredProducts-content text-center p-3">
                        <h6 class="fw-bold">{{ rp.productName }}</h6>
                        <p>
                            <span *ngIf="rp.discountPrice" class="text-success">₹{{ rp.discountPrice }}</span>
                            <span [class.text-decoration-line-through]="rp.discountPrice">₹{{ rp.price }}</span>
                        </p>
                        <div>
                            <ng-container *ngFor="let star of [1,2,3,4,5]">
                                <i class="bi" [ngClass]="{
                  'bi-star-fill text-warning': star <= rp.rating.average,
                  'bi-star': star > rp.rating.average
                }"></i>
                            </ng-container>
                            <small class="text-muted">({{ rp.rating.count }})</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>