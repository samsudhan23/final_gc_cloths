<button class="ml-2 btn btn-outline-secondary px-4 rounded-pill shadow-sm hover-scale back-btn" (click)="goBack()"><i
        class="bi bi-arrow-left me-2"></i>Back
    to Products</button>
<div class="container py-5" *ngIf="filteredProducts">
    <div class="row g-5 align-items-center">
        <!-- Gallery -->
        <div class="col-md-6">
            <div class="main-img text-center mb-3">
                <img [src]="filteredProducts.images" alt="{{filteredProducts.productName}}" class="img-fluid rounded shadow">
            </div>
            <div class="thumb-gallery d-flex justify-content-center gap-2">
                <img *ngFor="let img of filteredProducts.gallery" [src]="img" alt="{{filteredProducts.productName}}" class="thumb-img"
                    (click)="changeImage(img)">
            </div>
        </div>

        <!-- filteredProducts Info -->
        <div class="col-md-6">
            <h2 class="fw-bold">{{ filteredProducts.productName }}</h2>
            <p class="text-muted">{{ filteredProducts.productDescription }}</p>

            <!-- Price -->
            <p class="fs-4">
                <span *ngIf="filteredProducts.discountPrice" class="text-success fw-bold">₹{{ filteredProducts.discountPrice }}</span>
                <span [class.text-muted]="filteredProducts.discountPrice"
                    [class.text-decoration-line-through]="filteredProducts.discountPrice">
                    ₹{{ filteredProducts.price }}
                </span>
            </p>

            <!-- Category & Gender -->
            <p><strong>Category:</strong> {{ filteredProducts.category.categoryName }}</p>
            <p><strong>Gender:</strong> {{ filteredProducts.gender.genderName }}</p>

            <!-- Sizes -->
            <div class="mb-3">
                <strong>Available Sizes:</strong>
                <div class="d-flex gap-2 mt-2 flex-wrap">
                    <span *ngFor="let size of filteredProducts.sizeStock" (click)="selectSize(size)" class="size-chip" [ngClass]="{
                            'selected': selectedSize === size.size,
                            'disabled': size.stock === 0}">
                        {{ size.size }} ({{ size.stock }})
                    </span>
                </div>
            </div>


            <!-- Stock Info -->
            <p>
                <span *ngIf="!filteredProducts.inStock" class="badge bg-danger">Out of Stock</span>
                <span *ngIf="filteredProducts.inStock && filteredProducts.totalStock <= 5" class="badge bg-warning text-dark">Low
                    Stock</span>
                <span *ngIf="filteredProducts.inStock && filteredProducts.totalStock > 5" class="badge bg-success">In Stock</span>
            </p>
            <!-- Quantity -->
            <div class="mb-8"><strong><label class="block mb-3 text-foreground">Quantity</label></strong>
                <div class="flex items-center space-x-2">
                    <button (click)="quantityAdding('minus')"
                        class="inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg]:size-4 [&amp;_svg]:shrink-0 border shadow-sm h-11 w-11 bg-neutral text-neutral-foreground border-border hover:bg-gray-200 hover:text-primary transition-colors duration-150"
                        aria-label="Decrease quantity" [disabled]="quantityValue == 1">
                        <i class="pi pi-minus" style="font-size: 1rem"></i>
                    </button>
                    <input [disabled]="true" [(ngModel)]="quantityValue" type="number" min="1" max="99"
                        class="w-16 pl-[13px] h-11 text-center border border-border rounded-md bg-neutral text-foreground font-medium focus:outline-none focus:ring-2 focus:ring-primary"
                        aria-label="Quantity" value="1">
                    <button (click)="quantityAdding('add')" [disabled]="quantityValue == this.stock"
                        class="inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg]:size-4 [&amp;_svg]:shrink-0 border shadow-sm h-11 w-11 bg-neutral text-neutral-foreground border-border hover:bg-gray-200 hover:text-primary transition-colors duration-150"
                        aria-label="Increase quantity">
                        <i class="pi pi-plus" style="font-size: 1rem"></i>
                    </button>

                </div>
            </div>

            <!-- Buttons -->
            <div class="d-flex gap-3 mt-4 flex-wrap">
                <!-- Buy Now -->
                <button class="btn buy-now-btn px-4 rounded-pill shadow-sm hover-scale" (click)="buyNow(filteredProducts)">
                    <i class="bi bi-bag-check-fill me-2"></i>Buy Now
                </button>
                @if(!isGotoCart){
                <button class="btn btn-outline-secondary px-4 rounded-pill shadow-sm hover-scales"
                    (click)="addToCart(filteredProducts)">
                    <i class="bi bi-cart me-2"></i>Add to Cart
                </button>
                }
                @if(isGotoCart){
                <button class="btn buy-now-btn px-4 rounded-pill shadow-sm hover-scales" (click)="goToCart()">
                    <i class="bi bi-cart me-2"></i>Go to Cart
                </button>
                }
                <button class="btn btn-outline-danger px-4 rounded-pill shadow-sm hover-scale"
                    (click)="toggleWishlist(filteredProducts,$event)">
                    <i
                        [ngClass]="{ 'bi bi-heart': !filteredProducts.isWishlisted, 'bi bi-heart-fill text-danger': filteredProducts.isWishlisted }"></i>
                    Wishlist
                </button>
                <!-- <button class="btn btn-outline-secondary px-4 rounded-pill shadow-sm hover-scale back-btn"
                    (click)="goBack()"><i class="bi bi-arrow-left me-2"></i>Back
                    to Products</button> -->
            </div>

            <!-- Share and Delivery Section -->
            <div class="mt-8 border-t pt-5 space-y-6">

                <!-- Share Icons -->
                <div class="flex flex-wrap items-center gap-3">
                    <span class="font-medium text-gray-800 text-base">Share</span>

                    <div class="flex items-center gap-4">
                        <a [href]="'https://wa.me/?text=Check this out: ' + currentUrl" target="_blank"
                            class="text-green-500 hover:scale-110 transition">
                            <i class="bi bi-whatsapp text-2xl"></i>
                        </a>

                        <a [href]="'https://www.facebook.com/sharer/sharer.php?u=' + currentUrl" target="_blank"
                            class="text-blue-600 hover:scale-110 transition">
                            <i class="bi bi-facebook text-2xl"></i>
                        </a>

                        <a [href]="'https://twitter.com/intent/tweet?url=' + currentUrl" target="_blank"
                            class="text-sky-400 hover:scale-110 transition">
                            <i class="bi bi-twitter-x text-2xl"></i>
                        </a>

                        <a href="https://www.instagram.com/" target="_blank"
                            class="text-pink-500 hover:scale-110 transition">
                            <i class="bi bi-instagram text-2xl"></i>
                        </a>

                        <!-- Copy Link -->
                        <button (click)="copyLink()" class="relative text-gray-600 hover:scale-110 transition"
                            title="Copy link">
                            <i class="bi bi-link-45deg text-2xl"></i>
                            <span *ngIf="linkCopied"
                                class="absolute -top-6 left-1/2 -translate-x-1/2 bg-black text-white text-xs rounded px-2 py-1 opacity-90 animate-bounce">
                                Link Copied!
                            </span>
                        </button>
                    </div>
                </div>

                <!-- Delivery Details -->
                <div class="border-t pt-5">
                    <h3 class="font-semibold text-lg text-gray-800 mb-3">Delivery Details</h3>

                    <div class="flex flex-wrap items-center gap-3">
                        <input type="text" [(ngModel)]="pincode" maxlength="6" placeholder="Enter Pincode"
                            class="border rounded-md px-4 py-2 w-40 focus:outline-none focus:ring-2 focus:ring-teal-600 text-gray-800" />

                        <button (click)="checkPincode()"
                            class="text-teal-600 font-semibold hover:underline transition text-sm uppercase">
                            {{ pincodeChecked ? 'Change' : 'Check' }}
                        </button>
                    </div>

                    <!-- Animated delivery info -->
                    <div [@slideToggle]="pincodeChecked ? 'open' : 'closed'"
                        class="overflow-hidden transition-all duration-300 ease-in-out">
                        <div class="mt-4 space-y-3 text-gray-700 text-sm sm:text-base">

                            <div class="flex items-start gap-3">
                                <i class="bi bi-cash-coin text-xl text-gray-800"></i>
                                <p>Cash on delivery is available</p>
                            </div>

                            <div class="flex items-start gap-3">
                                <i class="bi bi-truck text-xl text-gray-800"></i>
                                <p>Estimated Delivery by <strong>{{ estimatedDelivery }}</strong></p>
                            </div>

                            <div class="flex items-start gap-3 border-t pt-3">
                                <i class="bi bi-arrow-repeat text-xl text-gray-800"></i>
                                <p class="text-gray-600">
                                    This filteredProducts is eligible for return or exchange under our 07-days return or exchange
                                    policy.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>



        </div>
    </div>

    <div class="mt-10 space-y-4">
        <div *ngFor="let section of productSections" class="border rounded-lg shadow-sm overflow-hidden bg-white">
            <button (click)="toggleSection(section)"
                class="w-full flex justify-between items-center px-5 py-3 bg-gray-50 hover:bg-gray-100 transition-all duration-300">
                <span class="font-semibold text-gray-800 text-lg">
                    {{ section.title }}
                </span>
                <i class="bi bi-chevron-down text-gray-600" [@rotateChevron]="section.open ? 'up' : 'down'"></i>
            </button>

            <div [@expandCollapse]="section.open ? 'open' : 'closed'" class="text-gray-700 text-sm leading-relaxed">
                <div class="px-5 py-4">
                    <p [innerHTML]="section.content"></p>
                </div>
            </div>
        </div>
    </div>




    <!-- Related Products -->
    <div class="related-products mt-5" *ngIf="relatedProducts.length > 0">
        <h3 class="fw-bold mb-4">Related Products</h3>
        <div class="row g-4">
            <div class="col-lg-3 col-md-4 col-sm-6" *ngFor="let rp of relatedProducts">
                <div class="filteredProducts-card" (click)="goToDetails(rp)">
                    <div class="filteredProducts-img">
                        <img [src]="rp.images" [alt]="rp.productName" class="img-fluid front-img">
                    </div>
                    <div class="filteredProducts-content text-center p-3">
                        <h6 class="fw-bold">{{ rp.productName }}</h6>
                        <p>
                            <span *ngIf="rp.discountPrice" class="text-success">₹{{ rp.discountPrice }}</span>
                            <span [class.text-decoration-line-through]="rp.discountPrice">₹{{ rp.price }}</span>
                        </p>
                        <div>
                            <ng-container *ngFor="let star of [1,2,3,4,5]">
                                <i class="bi" [ngClass]="{
                  'bi-star-fill text-warning': star <= rp.rating.average,
                  'bi-star': star > rp.rating.average
                }"></i>
                            </ng-container>
                            <small class="text-muted">({{ rp.rating.count }})</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>